# A2A Agent용 프롬프트 템플릿 가이드

A2A Agent 컴포넌트에 연결할 4개의 Prompt Template 컴포넌트에 입력할 내용입니다.

## 1. Work Plan Prompt (작업 계획 수립용)

```text
사용자의 작업을 분석하고 A2A 에이전트를 활용한 작업 계획을 수립하세요.

사용자 작업: {user_task}

사용 가능한 에이전트:
{available_agents}

OUTPUT_SCHEMA 형식으로만 응답하세요:
{output_schema}

작업 계획 수립 시 다음 원칙을 준수하세요:
- **에이전트 능력 분석**: 각 에이전트의 outputs를 확인하여 한 번에 여러 결과를 생성할 수 있는지 판단
- **최적 에이전트 할당**: 각 작업의 요구사항과 에이전트 능력을 비교 분석하여 가장 적합한 에이전트를 즉시 할당
- **중복 작업 방지**: 에이전트가 여러 출력을 동시에 생성할 수 있다면 별도 작업으로 분리하지 말고 통합
- **사용자 요청을 정확히 분석**: 분석, 계산, 변환, 실행 등 구체적인 요구사항 파악
- **실제 입력 데이터 포함**: 사용자가 제공한 구체적인 텍스트, 숫자, 파일명 등을 정확히 작업의 inputs에 포함
- **요청되지 않은 작업 제외**: 사용자가 명시적으로 요청하지 않은 분석이나 처리는 포함하지 않음
- **수학적/계산적 요청 처리**: "곱하기", "나누기", "로그", "제곱" 등의 연산이 포함된 경우 해당 계산 작업을 명시적으로 포함
- **계산 단계 분리**: 데이터 추출과 수학적 계산은 별도 작업으로 분리 (다른 에이전트 담당)
- 목표를 명확한 산출물 중심으로 분해 (10분 내 완료 가능한 크기)
- 작업 산출물은 작업에 필요한 내용만 등록 (Agent 생성하더라도 작업에 필요하지 않은 경우 등록하지 않음)
- 각 태스크에 담당 에이전트/필요 스킬/입출력/완료 기준/의존성/추정 시간 명시
- 위상정렬 가능한 순서의 실행 계획 제시
- 리스크와 대안 포함, 병렬화 가능 구간 명시

**에이전트 할당 기준**:
- 각 작업의 required_skills와 expected_outputs를 에이전트의 capabilities와 정확히 매칭
- 에이전트의 성능과 신뢰성을 고려하여 최적의 에이전트 선택
- 계산 작업이나 에이전트 역량 밖의 작업은 "self"로 할당

**중요 예시**:

1. **에이전트 통합 예시**: text-analyzer가 "단어 수, 토큰 수" 모두 출력 가능한 경우
   - ❌ 잘못된 계획: "단어 수 계산" + "토큰 수 계산" (2개 작업)
   - ✅ 올바른 계획: "텍스트 분석 (단어수 + 토큰수)" (1개 작업)

2. **수학 계산 포함 예시**: "안녕하세요? 반갑습니다!" 이 문장의 단어수와 토큰수를 구하여 곱한 값의 자연로그 계산"
   - ✅ 올바른 계획:
     * T1: 텍스트 분석 (단어 수, 토큰 수 추출) → text-analyzer
       - inputs: ["안녕하세요? 반갑습니다!"]
     * T2: 수학 계산 (곱셈 + 자연로그) → self
       - inputs: ["단어 수", "토큰 수"]
   - ❌ 잘못된 계획: inputs에 "사용자 제공 문장" 등 일반적 설명 사용

3. **요청 범위 준수 예시**: 사용자가 "감정 분석"을 요청하지 않았다면
   - ❌ 잘못된 계획: 텍스트 분석에 "문장 성격" 포함
   - ✅ 올바른 계획: 요청된 "단어 수, 토큰 수"만 포함
```

## 2. Planning Prompt (계획 검토 및 개선용)

```text
현재 작업 계획을 검토하고 개선사항을 제시하세요:

현재 계획:
{current_plan}

사용 가능한 에이전트:
{available_agents}

**중요 제약사항**:
- **기존 작업 구조 유지**: 이미 설계된 작업들을 임의로 병합하거나 분할하지 마세요
- **작업 ID 보존**: 기존 작업 ID (T1, T2 등)는 절대 변경하지 마세요
- **작업 내용 보존**: 각 작업의 고유한 목적과 출력을 변경하지 마세요

다음 관점에서 계획을 **미세 조정**하세요:
1. 작업 분할의 적절성 (크기, 복잡도, 의존성) - 단, 기존 구조 유지
2. 에이전트 할당의 최적성 - 더 나은 에이전트가 있다면 재할당
3. 실행 순서와 병렬화 가능성 - 의존성 관계 최적화
4. 리스크 요소와 완화 방안 - 위험 요소 식별 및 대응책
5. 예상 소요 시간의 현실성 - 시간 추정 조정

**경미한 개선사항만** JSON 형식으로 반환하세요.
```

## 3. Critic Prompt (실행 결과 분석 및 비평용)

```text
실행 결과를 분석하고 비평해주세요:

**중요: Planning-Dispatcher-Critic (PDC) 사이클 컨텍스트**
- 작업은 **순차적으로 한 번에 하나씩** 처리됩니다 (병렬 실행 아님)
- 각 작업 완료 후 Critic 분석을 수행하고, 다음 작업을 진행합니다
- 아직 처리되지 않은 작업들은 **대기 중** 상태이며, 이는 정상적인 진행 과정입니다
- task_summary의 execution_context를 참조하여 현재 진행 상황을 정확히 파악하세요

**중요 제약사항: 작업 ID 보존**
- **기존 작업 ID는 절대 변경하지 마세요** (T1 → T1.1로 변경 금지)
- 이미 처리된 작업의 ID를 수정하면 시스템이 혼동하여 오작동합니다
- 계획 개선 시에는 작업 내용이나 순서만 조정하고, ID는 그대로 유지하세요

실행 결과:
{execution_results}

현재 계획:
{current_plan}

작업 요약:
{task_summary}

실행 결과를 종합적으로 분석하여 다음을 제공하세요:
1. 전체적인 성과 평가
2. 성공/실패 요인 분석  
3. 다음 단계 액션 제안
4. 계획 개선 방안
5. 작업 완료 여부 판단
   - **is_complete: true**: 모든 계획된 작업이 성공적으로 완료된 경우에만
   - **is_complete: false**: 아직 대기 중인 작업이 있거나 실패한 작업이 있는 경우

JSON 형식으로 응답하세요:
{{
    "critique": "종합적인 비평 및 분석",
    "is_complete": true/false,
    "next_actions": ["다음 단계 액션들"],
    "improvement_suggestions": ["개선 제안들"],
    "updated_plan": {{...}}  // 필요시 수정된 계획
}}
```

## 사용 방법

1. Langflow에서 3개의 **Prompt Template** 컴포넌트를 생성
2. 각 컴포넌트의 **Template** 필드에 위 내용을 복사하여 입력
3. 각 Prompt Template 컴포넌트의 **Prompt** 출력을 A2A Agent의 해당 입력에 연결:
   - Work Plan Prompt Template → A2A Agent의 "Work Plan Prompt (필수)"
   - Planning Prompt Template → A2A Agent의 "Planning Prompt (필수)"
   - Critic Prompt Template → A2A Agent의 "Critic Prompt (필수)"

## 주의사항

- 모든 프롬프트는 **필수 연결**입니다.
- 프롬프트가 연결되지 않으면 에러가 발생하고 실행이 중지됩니다.
- 중괄호 `{variable}` 안의 변수들은 A2A Agent에서 자동으로 주입됩니다.
- JSON 예시에서 이중 중괄호 `{{}}` 사용: Langflow는 `{}`를 변수로 인식하므로 JSON 구조 표시 시 `{{}}`를 사용합니다.
- 프롬프트 내용은 필요에 따라 수정 가능하지만, 변수명은 유지해야 합니다.
